version: '3.8'
name: news_reporter
services:
  news_reporter:
    image: openclaw-feishu:v1
    container_name: news_reporter
    
    environment:
      # ==========================================
      # 代理配置 - 通过 host.docker.internal 访问宿主机的 VPN
      # 根据你的 VPN 软件修改端口 (常见: 7890, 1080, 8080)
      # ==========================================
      - HTTP_PROXY=http://host.docker.internal:7890
      - HTTPS_PROXY=http://host.docker.internal:7890
      - ALL_PROXY=socks5://host.docker.internal:7890
      
      # ==========================================
      # 其他配置
      # ==========================================
      - TZ=Asia/Shanghai
      - PYTHONUNBUFFERED=1
      - PYTHONIOENCODING=utf-8
      
    # 直接从 .env 文件加载所有配置
    env_file:
      - .env
      
    volumes:
      # SSH 密钥 - 从宿主机挂载（路径从环境变量 SSH_KEY_PATH 读取）
      # 注意：需要挂载私钥文件（不是 .pub 文件）
      - ${SSH_KEY_PATH}:/tmp/host_ssh_key:ro
      
      # 启动脚本 - 从本地挂载
      - ./entrypoint.sh:/app/entrypoint.sh:ro
      
      # 保存 openclaw 工作空间（可选，如果需要保持登录状态）
      - news_reporter_openclaw:/root/.openclaw/workspace
      
    # 工作目录
    working_dir: /app
    
    # 保持容器运行，方便手动执行
    stdin_open: true
    tty: true
    
    # 启动脚本
    command: ["bash", "/app/entrypoint.sh"]
    
    # 网络配置 - 使用桥接网络，通过 host.docker.internal 访问宿主机
    extra_hosts:
      - "host.docker.internal:host-gateway"

# 命名卷 - 仅保留必要的
volumes:
  news_reporter_openclaw:
    name: news_reporter_openclaw
